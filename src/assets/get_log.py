import requests

# 设置 API 请求的 URL 和请求头
url = 'https://api.loganalytics.io/v1/workspaces/39743c52-8e86-43b1-987e-cc5d848ecce7/query?timespan=PT30M'
headers = {
    'Accept': 'application/json',
    'Content-Type': 'application/json',
    'Authorization': 'Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ii1LSTNROW5OUjdiUm9meG1lWm9YcWJIWkdldyIsImtpZCI6Ii1LSTNROW5OUjdiUm9meG1lWm9YcWJIWkdldyJ9.eyJhdWQiOiJjYTdmM2YwYi03ZDkxLTQ4MmMtOGUwOS1jNWQ4NDBkMGVhYzUiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC8xNTA0MGEyNC1kYTlhLTRmYWYtODZlOS04YWU4NTJhMmU2ZjgvIiwiaWF0IjoxNjgyODQ3NzU1LCJuYmYiOjE2ODI4NDc3NTUsImV4cCI6MTY4Mjg1Mjg2MiwiYWNyIjoiMSIsImFpbyI6IkFZUUFlLzhUQUFBQUp3QjVTdGJsczV1U3RFSkFLN2l6TjlOTjVxN3FvbjBWamlSdE0zN0h1dmlOMFF6V3phYytBbVRXeGFtRkl3UFpSUFNyYnptQnFuZE90eXRNYk95S2o4YXI5NVlqTThaY0FkaFJONk1UQS9LSlczT3o3aUhCeTJTa0JCMit5c1ZaZzdjbzZLSjZGelY0ZzgzSis1dFl6VG5BMHNXTXF5T2NzWklaRXZJMnFCbz0iLCJhbHRzZWNpZCI6IjE6bGl2ZS5jb206MDAwNjdGRkUyMzFBNkQ1QSIsImFtciI6WyJwd2QiLCJtZmEiXSwiYXBwaWQiOiI2ZTAwYjMxZi0wNmQ0LTRjOTMtOGIxNC1lMDhiNTY4YjRhMDQiLCJhcHBpZGFjciI6IjAiLCJlbWFpbCI6Ilh1Y2hlbnlhbmcwNkBob3RtYWlsLmNvbSIsImZhbWlseV9uYW1lIjoi5b6QIiwiZ2l2ZW5fbmFtZSI6Iui-sOa0iyIsImlkcCI6ImxpdmUuY29tIiwiaXBhZGRyIjoiMTE2Ljg4LjE5Ni4xNzIiLCJuYW1lIjoiWHVjaGVueWFuZzA2Iiwib2lkIjoiNjc0Y2I5MzAtMjMwOC00ZWJkLThjMDktNDljN2RjMzA1N2YyIiwicHVpZCI6IjEwMDMyMDAyNjVBNDIxNUMiLCJyaCI6IjAuQVVvQUpBb0VGWnJhcjAtRzZZcm9VcUxtLUFzX2Y4cVJmU3hJamduRjJFRFE2c1dKQU1ZLiIsInNjcCI6InVzZXJfaW1wZXJzb25hdGlvbiIsInN1YiI6Ikw5Y3lkTFpyMVJvSW9YcVBvTmViSDlOOHFtQXMzbnlfMVp0OTJPbFdSemsiLCJ0aWQiOiIxNTA0MGEyNC1kYTlhLTRmYWYtODZlOS04YWU4NTJhMmU2ZjgiLCJ1bmlxdWVfbmFtZSI6ImxpdmUuY29tI1h1Y2hlbnlhbmcwNkBob3RtYWlsLmNvbSIsInV0aSI6InE2U3hFNk1XU0VtUV9MeVpNaTllQUEiLCJ2ZXIiOiIxLjAiLCJ3aWRzIjpbIjEzYmQxYzcyLTZmNGEtNGRjZi05ODVmLTE4ZDNiODBmMjA4YSJdfQ.LO0Y1gxiOoYjHUTRwbnf_wSua-BlSa7D401ZC8l49KGw9M2UtTUqP-p52dY3aqgfWltOHw-fyeHSXji_jSO-CNrgnWQ9bvm2Z0ZHVeygNAgg6AENqMR7gZOwsd7lQes49_HNymPnJyAQc7_4cKv9G2Vp_DPiioAtFwfvLBaMZPQPRIeOKQlkvt9c4ZVEQvInuT89XlhdvXn0iS9PGXibiwWbcWvpeFAgnHxXz70us91IFqBJTjPaHeByioeFUmyTN4abEGa0Lr8PvXUz0WZjOgwvE2adRTTJzflnbNveV-vrhEIfP3STuq1GTDMWnbP8PQmzHgeIkYg0AUf9ZRTcUg'
}

# 设置 API 请求的正文（查询字符串）
query = 'Event | where Source == "Microsoft-Windows-Sysmon"'

# 发送 HTTP POST 请求
response = requests.post(url, headers=headers, json={'query': query})

# 检查响应状态码
if response.status_code == 200:
    # 响应正常，输出响应内容
    print(response.json())
else:
    # 响应出错，输出错误信息
    print('Error: ' + response.text)